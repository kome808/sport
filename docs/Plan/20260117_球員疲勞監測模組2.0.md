# çƒå“¡ç–²å‹ç›£æ¸¬æ¨¡çµ„ 2.0 â€” FatigueGuard

## ç‰ˆæœ¬æ›´æ–°èªªæ˜

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦è®Šæ›´ |
|------|------|----------|
| 1.0  | 2026-01-13 | åˆç‰ˆ 5 å¤§æŒ‡æ¨™å®šç¾© |
| 1.1  | 2026-01-15 | æ–°å¢ EWMA è§£è€¦è¨ˆç®—ã€èª å¯¦åº¦æª¢æŸ¥ |
| **2.0** | **2026-01-17** | **æ ¸å¿ƒé‚è¼¯ä¿®æ”¹ï¼šæœ¨æ¡¶æ•ˆæ‡‰åˆ¤å®šã€æ™ºæ…§ä¼‘æ¯æ—¥åµæ¸¬ã€æ•¸æ“šå®Œæ•´åº¦æŒ‡ç¤ºå™¨** |

---

## æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

### æœ¨æ¡¶æ•ˆæ‡‰ï¼ˆWorst-Case Principleï¼‰

> [!IMPORTANT]
> **ç³»çµ±è©•åˆ†ä¸å–å¹³å‡å€¼ï¼Œè€Œæ˜¯å–æ±ºæ–¼ç•¶å‰è¡¨ç¾ã€Œæœ€å·®ã€çš„ä¸€å€‹æŒ‡æ¨™ã€‚**
> åªè¦æœ‰ä¸€å€‹é›¶ä»¶å£äº†ï¼Œé€™è¼›è»Šå°±ä¸è©²ä¸Šè·¯ã€‚

**è¨­è¨ˆç†ç”±ï¼š**
- å‚³çµ±ã€ŒåŠ æ¬Šå¹³å‡ã€æœƒè®“å–®é …åš´é‡ç•°å¸¸è¢«å…¶ä»–æ­£å¸¸æ•¸æ“šã€Œç¨€é‡‹ã€ï¼Œå°è‡´æ•™ç·´æ¼æ‰é—œéµå—å‚·è­¦è¨Š
- é’å°‘å¹´çƒå“¡æ•¸æ“šå¡«å¯«å¸¸ä¸å®Œæ•´ï¼Œå¹³å‡è¨ˆç®—æ›´å®¹æ˜“å¤±çœŸ
- å®‰å…¨å°å‘è¨­è¨ˆï¼šã€Œä¸æ¼æ‰ä»»ä½•ä¸€å€‹æ½›åœ¨é¢¨éšªã€

---

## æŒ‡æ¨™åˆ¤å®šæ¨™æº–

### é¢¨éšªç­‰ç´šå®šç¾©

| Level | ç‹€æ…‹ | é¢¨éšªæ¬Šé‡ | èªªæ˜ |
|-------|------|----------|------|
| L0    | âšª ç¼ºå¤± | 0 | æ•¸æ“šæœªå¡«å¯«ï¼Œä¸åƒèˆ‡åˆ¤å®š |
| L1    | ğŸŸ¢ æ­£å¸¸ | 1 | å®‰å…¨å€ |
| L2    | ğŸŸ¡ æ³¨æ„ | 2 | ç›£æ¸¬å€ |
| L3    | ğŸ”´ é«˜é¢¨éšª | 3 | éœ€ç«‹å³é—œæ³¨ |

### å„æŒ‡æ¨™é–¾å€¼å½™æ•´

| æŒ‡æ¨™ | ğŸŸ¢ æ­£å¸¸ (L1) | ğŸŸ¡ æ³¨æ„ (L2) | ğŸ”´ é«˜é¢¨éšª (L3) |
|------|-------------|-------------|---------------|
| **ACWR (EWMA)** | 0.80 - 1.30 | 1.31 - 1.50 | > 1.50 |
| **RHR (æ™¨é–“å¿ƒè·³)** | åŸºæº– Â±3 bpm | åŸºæº– +4~7 bpm | åŸºæº– +8 bpm ä»¥ä¸Š |
| **Wellness (èº«å¿ƒ)** | 20 - 25 åˆ† | 15 - 19 åˆ† | < 15 åˆ† |
| **sRPE (ä»Šæ—¥è² è·)** | 0 - 399 AU | 400 - 599 AU | â‰¥ 600 AU |

---

## æ•´é«”ç‹€æ…‹åˆ¤å®šé‚è¼¯

### å–æ¶ˆåŠ æ¬Šå¹³å‡ï¼Œæ”¹ç”¨ã€Œæœ€é«˜é¢¨éšªæƒæã€

**å…¬å¼ï¼š**
```
Overall Status = max(L_ACWR, L_RHR, L_Wellness, L_sRPE)
```

**é‚è¼¯èªªæ˜ï¼š**
1. ç³»çµ±æƒææ‰€æœ‰å­æŒ‡æ¨™çš„é¢¨éšªç­‰ç´š (L)
2. å–ç­‰ç´šæœ€é«˜ï¼ˆé¢¨éšªæœ€é«˜ï¼‰è€…ä½œç‚ºç•¶æ—¥é¡¯ç¤ºç‹€æ…‹
3. åŒæ™‚è¨˜éŒ„ã€Œèª˜ç™¼å› ç´ ã€ï¼Œå³é€ æˆæœ€é«˜é¢¨éšªçš„æŒ‡æ¨™åç¨±

### æ•¸æ“šç¼ºå¤±è™•ç†è¦å‰‡

| æƒ…å¢ƒ | è™•ç†æ–¹å¼ |
|------|----------|
| æŸé …æ•¸æ“šç¼ºå¤±ï¼ˆçƒå“¡æœªå¡«ï¼‰ | è©²é …ä¸åƒèˆ‡ `max()` è¨ˆç®— |
| æ‰€æœ‰æŒ‡æ¨™çš†ç¼ºå¤± | é¡¯ç¤ºã€Œâšª æ•¸æ“šä¸è¶³ã€ |
| åƒ…æœ‰ 1 é …æœ‰æ•¸æ“š | ä»¥è©²é …ç‚ºæº– |

---

## æ™ºæ…§ä¼‘æ¯æ—¥åµæ¸¬ï¼ˆæ–¹æ¡ˆ Bï¼‰

### åµæ¸¬é‚è¼¯

ç³»çµ±è‡ªå‹•åˆ¤æ–·æ˜¯å¦ç‚ºã€ŒçƒéšŠä¼‘æ¯æ—¥ã€ï¼Œç„¡éœ€æ•™ç·´æ‰‹å‹•æ¨™è¨˜ï¼š

```javascript
function isTeamRestDay(teamId, date) {
    const records = getDailyRecords(teamId, date);
    const hasAnyTraining = records.some(r => r.srpe > 0);
    return !hasAnyTraining; // å…¨éšŠéƒ½æ²’æœ‰è¨“ç·´è¨˜éŒ„ â†’ ä¼‘æ¯æ—¥
}
```

### ä¼‘æ¯æ—¥çš„è³‡æ–™è™•ç†

| é …ç›® | è™•ç†æ–¹å¼ |
|------|----------|
| sRPE | è¦–ç‚º `0 AU`ï¼Œæ­£å¸¸åƒèˆ‡ EWMA è¨ˆç®— |
| Wellness | å¯å¡«å¯ä¸å¡«ï¼Œæœªå¡«è¦–ç‚ºç¼ºå¤± |
| RHR | å¯å¡«å¯ä¸å¡«ï¼Œæœªå¡«è¦–ç‚ºç¼ºå¤± |
| ACWR | çŸ­æœŸè² è·å›  sRPE=0 è€Œä¸‹é™ï¼Œæœ‰åˆ©æ–¼æ¢å¾© |
| æ•´é«”ç‹€æ…‹ | è‹¥åªæœ‰ sRPE=0ï¼Œé¡¯ç¤ºã€ŒğŸ”µ ä¼‘æ¯æ—¥ã€ |

### ä¼‘æ¯æ—¥å„€è¡¨æ¿é¡¯ç¤º

```
ğŸ”µ ä»Šæ—¥ä¼‘æ¯æ—¥
ACWR: 1.12 ğŸŸ¢ (æŒçºŒå®‰å…¨å€)
å»ºè­°æŒçºŒè¿½è¹¤ Wellness èˆ‡ RHR
```

---

## æ•¸æ“šå®Œæ•´åº¦æŒ‡ç¤ºå™¨

### è¨­è¨ˆç›®çš„

è®“æ•™ç·´æ¸…æ¥šçŸ¥é“ä»Šå¤©çƒå“¡å¡«äº†å¹¾é …ï¼Œé¿å…ã€Œå› ç‚ºæ²’å¡«è€Œçœ‹ä¸åˆ°å•é¡Œã€ã€‚

### é¡¯ç¤ºæ ¼å¼

```
ğŸ“Š æ•¸æ“šå®Œæ•´åº¦ï¼š3/4 é … (ç¼º RHR)
```

### è¨ˆç®—é‚è¼¯

```javascript
function getDataCompleteness(dailyData) {
    const fields = ['acwr', 'rhr', 'wellness', 'srpe'];
    const filled = fields.filter(f => dailyData[f] !== null);
    const missing = fields.filter(f => dailyData[f] === null);
    
    return {
        filledCount: filled.length,
        totalCount: fields.length,
        missingFields: missing.map(f => fieldNameMap[f])
    };
}
```

---

## ACWR è¨ˆç®—ï¼ˆEWMA è§£è€¦ç‰ˆï¼‰

### è¨ˆç®—å…¬å¼

```
çŸ­æœŸè² è· (Acute) = EWMA(æœ€è¿‘ 7 å¤©, Î»=0.25)
é•·æœŸè² è· (Chronic) = EWMA(ç¬¬ 8-28 å¤©, Î»=0.07)  // è§£è€¦ï¼
ACWR = çŸ­æœŸ Ã· é•·æœŸ
```

### EWMA å…¬å¼

```
EWMA_today = (sRPE_today Ã— Î») + (EWMA_yesterday Ã— (1 - Î»))
```

### è§£è€¦è¨­è¨ˆèªªæ˜

> [!NOTE]
> å‚³çµ± ACWR ä½¿ç”¨æ»¾å‹•å¹³å‡ï¼ŒçŸ­æœŸè² è·æœƒåŒ…å«åœ¨é•·æœŸè² è·å…§ï¼Œå°è‡´ç›¸é—œæ€§éé«˜ã€‚
> è§£è€¦ç‰ˆå°‡é•·æœŸè² è·è¨­å®šç‚ºã€Œç¬¬ 8-28 å¤©ã€ï¼Œæ’é™¤è¿‘æœŸ 7 å¤©æ•¸æ“šï¼Œæ›´èƒ½åæ˜ çœŸæ­£çš„åŸºç·šã€‚

### ä¼‘æ¯æ—¥è™•ç†

- ä¼‘æ¯æ—¥çš„ `sRPE = 0` **æ­£å¸¸åƒèˆ‡ EWMA è¨ˆç®—**
- é€™æœƒè®“çŸ­æœŸè² è·ä¸‹é™ï¼Œå¯¦éš›ä¸Šæœ‰åˆ©æ–¼é™ä½ ACWR

---

## å„€è¡¨æ¿ UI è¨­è¨ˆ

### ä¸»è¦é¡¯ç¤ºå€

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š æ•´é«”ç‹€æ…‹ï¼š46 ğŸ”´ é«˜é¢¨éšª
   âš ï¸ ç•¶å‰ç”± [ä»Šæ—¥è¨“ç·´è² è·] åˆ¤å®š
   
   æ•¸æ“šå®Œæ•´åº¦ï¼š4/4 é … âœ…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### å­æŒ‡æ¨™å€å¡Šï¼ˆå›ºå®šé †åºï¼‰

> [!TIP]
> æŒ‡æ¨™é †åºå›ºå®šä¸è®Šï¼Œè®“ä½¿ç”¨è€…ç¿’æ…£åœ¨å›ºå®šä½ç½®æŸ¥çœ‹ã€‚
> æœ€å·®çš„æŒ‡æ¨™ç”¨**é†’ç›®é‚Šæ¡†/èƒŒæ™¯è‰²**æ¨™ç¤ºï¼Œè€Œéæ”¹è®Šä½ç½®ã€‚

**å›ºå®šé †åºï¼ˆç”±ä¸Šåˆ°ä¸‹ï¼‰ï¼š**
1. ğŸ”¥ ACWRï¼ˆæ€¥æ…¢æ€§è¨“ç·´è² è·æ¯”ï¼‰
2. â¤ï¸ RHRï¼ˆæ™¨é–“å¿ƒè·³ï¼‰
3. ï¿½ Wellnessï¼ˆèº«å¿ƒç‹€æ…‹ï¼‰
4. ğŸ’ª sRPEï¼ˆä»Šæ—¥è¨“ç·´è² è·ï¼‰

**è¦–è¦ºæ¨™ç¤ºè¦å‰‡ï¼š**
- æœ€å·®æŒ‡æ¨™ï¼šç´…è‰²é‚Šæ¡† + èƒŒæ™¯æ·¡ç´…è‰² + âš ï¸ æ¨™è¨˜
- å…¶ä»–æŒ‡æ¨™ï¼šæ­£å¸¸æ¨£å¼

**ç¯„ä¾‹å‘ˆç¾ï¼š**
```
ğŸŸ¢ ğŸ”¥ ACWRï¼š1.18 â€” å®‰å…¨å€
ğŸŸ¡ â¤ï¸ æ™¨é–“å¿ƒè·³ï¼š58 bpm (+6æ¬¡) â€” è¼•å¾®ç–²å‹
ğŸŸ¢ ğŸ˜Š èº«å¿ƒç‹€æ…‹ï¼š22/25 â€” ç‹€æ…‹è‰¯å¥½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ï¿½ ï¿½ ä»Šæ—¥è¨“ç·´è² è·ï¼š720 AU âš ï¸ èª˜ç™¼å› ç´  â”‚  â† æœ€å·®æŒ‡æ¨™ï¼Œç´…æ¡†æ¨™ç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 14 å¤©è¶¨å‹¢åœ–

ä¿ç•™è¶¨å‹¢åœ–è¡¨ï¼Œè®“æ•™ç·´åˆ¤æ–·ç•°å¸¸æ˜¯ã€Œå–®ä¸€äº‹ä»¶ã€é‚„æ˜¯ã€ŒæŒçºŒæƒ¡åŒ–ã€ï¼š

```
14 å¤© sRPE è¶¨å‹¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â–ˆ                         â”‚
â”‚   â–ˆ   â–ˆ â–ˆ     â–ˆ                â”‚
â”‚ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ   â–ˆ â–ˆ   â–ˆ â–ˆ â–ˆ     â”‚
â”‚ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ   â”‚
â””â”€â”€1â”€2â”€3â”€4â”€5â”€6â”€7â”€8â”€9â”€10â”€11â”€12â”€13â”€14â”€â”˜
                              ä»Šæ—¥ â†‘
```

---

## é€£çºŒç•°å¸¸è­¦ç¤ºï¼ˆStreak Penaltyï¼‰

### è¨­è¨ˆç›®çš„

å–®æ—¥ç•°å¸¸å¯èƒ½æ˜¯å¶ç™¼äº‹ä»¶ï¼Œä½†é€£çºŒ 2-3 å¤©åŒä¸€æŒ‡æ¨™ç•°å¸¸ï¼Œé¢¨éšªæ‡‰è©²æ›´é«˜ã€‚

### é¡¯ç¤ºè¦å‰‡

| é€£çºŒå¤©æ•¸ | é¡¯ç¤ºè™•ç† |
|---------|---------|
| 1 å¤©    | æ­£å¸¸ç‡ˆè™Ÿ |
| 2 å¤©    | ç‡ˆè™Ÿ + âš ï¸ æŒçºŒè­¦ç¤º |
| 3 å¤©+   | ç‡ˆè™Ÿ + ğŸ”¥ å»ºè­°ä¼‘æ¯ |

### ç¯„ä¾‹

```
ğŸ”´ ğŸ’ª ä»Šæ—¥è¨“ç·´è² è·ï¼š720 AU â€” æ¥µé«˜è² è·
   ğŸ”¥ é€£çºŒ 3 å¤©é«˜è² è·ï¼Œå¼·çƒˆå»ºè­°å®‰æ’æ¢å¾©æ—¥
```

---

## å¾Œç«¯è¨ˆç®—é‚è¼¯ï¼ˆPseudocodeï¼‰

```javascript
// é¢¨éšªç­‰ç´šå¸¸æ•¸
const RISK_LEVEL = { MISSING: 0, GREEN: 1, YELLOW: 2, RED: 3 };

// æŒ‡æ¨™åç¨±å°ç…§
const INDICATOR_NAMES = {
    acwr: 'æ€¥æ…¢æ€§è¨“ç·´è² è·æ¯” (ACWR)',
    rhr: 'æ™¨é–“å¿ƒè·³ (RHR)',
    wellness: 'èº«å¿ƒç‹€æ…‹ (Wellness)',
    srpe: 'ä»Šæ—¥è¨“ç·´è² è· (sRPE)'
};

/**
 * å–å¾—æ•´é«”è­¦ç¤ºç‹€æ…‹
 * @param {Object} dailyData - ç•¶æ—¥å„æŒ‡æ¨™æ•¸æ“š
 * @returns {Object} { level, cause, isRestDay, completeness }
 */
function getOverallAlert(dailyData) {
    const scores = {
        acwr: checkACWR(dailyData.acwr),
        rhr: checkRHR(dailyData.rhr, dailyData.rhrBaseline),
        wellness: checkWellness(dailyData.wellness),
        srpe: checkSRPE(dailyData.srpe)
    };
    
    // éæ¿¾æ‰ç¼ºå¤±æ•¸æ“š
    const validScores = Object.entries(scores)
        .filter(([_, level]) => level !== RISK_LEVEL.MISSING);
    
    // å…¨éƒ¨ç¼ºå¤±
    if (validScores.length === 0) {
        return { level: RISK_LEVEL.MISSING, cause: null, isRestDay: false };
    }
    
    // å–å¾—æœ€é«˜é¢¨éšªç­‰ç´š
    const maxEntry = validScores.reduce((max, curr) => 
        curr[1] > max[1] ? curr : max
    );
    
    // åˆ¤æ–·æ˜¯å¦ç‚ºä¼‘æ¯æ—¥ï¼ˆåƒ… sRPE=0 ä¸”ç„¡å…¶ä»–æ•¸æ“šï¼‰
    const isRestDay = dailyData.srpe === 0 && validScores.length === 1;
    
    return {
        level: maxEntry[1],
        cause: INDICATOR_NAMES[maxEntry[0]],
        isRestDay,
        completeness: {
            filled: validScores.length,
            total: 4,
            missing: Object.entries(scores)
                .filter(([_, level]) => level === RISK_LEVEL.MISSING)
                .map(([key]) => INDICATOR_NAMES[key])
        }
    };
}

// å„æŒ‡æ¨™åˆ¤å®šå‡½æ•¸
function checkACWR(acwr) {
    if (acwr === null) return RISK_LEVEL.MISSING;
    if (acwr > 1.5) return RISK_LEVEL.RED;
    if (acwr > 1.3) return RISK_LEVEL.YELLOW;
    if (acwr >= 0.8) return RISK_LEVEL.GREEN;
    return RISK_LEVEL.GREEN; // < 0.8 ä¹Ÿè¦–ç‚ºå®‰å…¨ï¼ˆä½è² è·ï¼‰
}

function checkRHR(rhr, baseline) {
    if (rhr === null || baseline === null) return RISK_LEVEL.MISSING;
    const diff = rhr - baseline;
    if (diff >= 8) return RISK_LEVEL.RED;
    if (diff >= 4) return RISK_LEVEL.YELLOW;
    return RISK_LEVEL.GREEN;
}

function checkWellness(wellness) {
    if (wellness === null) return RISK_LEVEL.MISSING;
    if (wellness < 15) return RISK_LEVEL.RED;
    if (wellness < 20) return RISK_LEVEL.YELLOW;
    return RISK_LEVEL.GREEN;
}

function checkSRPE(srpe) {
    if (srpe === null) return RISK_LEVEL.MISSING;
    if (srpe >= 600) return RISK_LEVEL.RED;
    if (srpe >= 400) return RISK_LEVEL.YELLOW;
    return RISK_LEVEL.GREEN;
}
```

---

## ç§‘å­¸ä¾æ“šåƒè€ƒ

| æŒ‡æ¨™ | æ–‡ç»ä¾†æº | é—œéµç™¼ç¾ |
|------|----------|----------|
| ACWR | Williams 2017 | ACWR > 1.5 æ™‚å‚·å®³é¢¨éšªå¢åŠ  4.8 å€ |
| RHR | Teo 2016 | RHR è®ŠåŒ–èˆ‡éåº¦è¨“ç·´ç—‡å€™ç¾¤ç›¸é—œ (r=0.85) |
| Wellness | Saw 2016 | Wellness èˆ‡ç”Ÿç‰©æ¨™èªŒç›¸é—œ (r=0.78) |
| sRPE | Foster 2016 | sRPE èˆ‡å¿ƒç‡ç›£æ¸¬é«˜åº¦ç›¸é—œ (r=0.88) |
| ç¶œåˆç›£æ¸¬ | Tibana 2019 | å¤šæŒ‡æ¨™ç¶œåˆç›£æ¸¬æº–ç¢ºç‡é” 88% |

---

## å¯¦ä½œå„ªå…ˆé †åº

1. **Phase 1ï¼šå¾Œç«¯ RPC å‡½æ•¸**
   - [ ] `get_player_fatigue_status(player_id, date)` â€” å–å¾—å–®ä¸€çƒå“¡ç•¶æ—¥ç‹€æ…‹
   - [ ] `calculate_acwr_ewma(player_id)` â€” è¨ˆç®— ACWR (EWMA è§£è€¦ç‰ˆ)

2. **Phase 2ï¼šå‰ç«¯ FatigueGuard å…ƒä»¶**
   - [ ] `FatigueGuard.tsx` â€” æ•´é«”ç‹€æ…‹é¡¯ç¤º
   - [ ] `IndicatorCard.tsx` â€” å–®ä¸€æŒ‡æ¨™å¡ç‰‡ï¼ˆå¯é»æ“Šå±•é–‹è©³æƒ…ï¼‰
   - [ ] `DataCompletenessBar.tsx` â€” æ•¸æ“šå®Œæ•´åº¦æŒ‡ç¤ºå™¨

3. **Phase 3ï¼šè¶¨å‹¢åœ–è¡¨**
   - [ ] 14 å¤© sRPE è¶¨å‹¢åœ–
   - [ ] é€£çºŒç•°å¸¸è­¦ç¤ºæ¨™è¨˜
