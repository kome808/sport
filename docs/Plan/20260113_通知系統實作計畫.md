# 通知系統實作計畫 (Phase 1.10)

> 日期：2026-01-13
> 主題：通知系統 (Notification System)

## 1. 目標
建立一套站內通知系統，讓教練能即時接收高風險預警與重要事件通知。

## 2. 變更內容

### 資料庫 (Database)
#### [NEW] `013_notifications.sql`
- 建立 `notifications` 資料表：
    - `id`: uuid (PK)
    - `user_id`: uuid (關聯 users)
    - `team_id`: uuid (關聯 teams)
    - `title`: text (標題)
    - `message`: text (內容)
    - `type`: text (info, warning, danger)
    - `is_read`: boolean (預設 false)
    - `link`: text (點擊導向連結)
    - `created_at`: timestamptz
- 建立 RLS 政策：
    - 使用者僅能看見屬於自己的通知。
- 建立自動觸發器 (Trigger)：
    - 當 `daily_records` 新增時，若 `acwr > 1.5` 或 `wellness_score < 15`，自動寫入一筆警示通知給該球員所屬球隊的教練。

### 前端 (Frontend)
#### [NEW] Hook: `useNotifications.ts`
- `useNotifications(userId)`: 取得未讀通知列表。
- `useMarkNotificationAsRead()`: 標記通知為已讀。

#### [NEW] Component: `NotificationBell.tsx`
- 放置於 Header 的通知鈴鐺圖示。
- 顯示未讀數量紅點。
- 點擊展開下拉選單，顯示最近通知。
- 點擊通知項目後，標記已讀並導航至相關頁面。

#### [MODIFY] Component: `Header.tsx`
- 整合 `NotificationBell` 元件。

## 3. 驗證計畫

### 手動驗證
1. **觸發器測試**：
   - 以球員身份提交一筆高風險訓練紀錄（例如 sRPE 9, 訓練時間 120分）。
   - 檢查資料庫 `notifications` 表是否產生新資料。
2. **UI 顯示測試**：
   - 切換至教練帳號登入。
   - 確認右上角鈴鐺出現紅點。
   - 點擊鈴鐺，應看到剛才的警示通知。
   - 點擊通知，確認紅點消失或數字減少，並跳轉至球員頁面。
